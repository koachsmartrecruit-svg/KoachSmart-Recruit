{% extends "base.html" %}
{% block title %}Post a Job{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row g-4">
    <div class="col-lg-8">

      <h1 class="h4 mb-1">Post a New Coaching Opportunity</h1>
      <p class="text-muted mb-4">
        Fill the details below. Coaches will see this in their job feed.
      </p>

      <div class="card shadow-sm border-0">
        <div class="card-body">
          <form method="post">
            <!-- Job title -->
            <div class="mb-3">
              <label class="form-label">Job Title</label>
              <input type="text"
                     name="title"
                     class="form-control"
                     placeholder="e.g. Cricket Head Coach"
                     value="{{ form_data.title if form_data and form_data.title else '' }}"
                     required>
            </div>

            <!-- Sport -->
            <div class="mb-3">
              <label class="form-label">Sport</label>
              <input type="text"
                     name="sport"
                     class="form-control"
                     placeholder="e.g. Cricket, Football"
                     value="{{ form_data.sport if form_data and form_data.sport else '' }}"
                     required>
            </div>

            <!-- Country / State / City -->
            <div class="row g-3 mb-3">
              <div class="col-md-4">
                <label class="form-label">Country</label>
                <select id="countrySelect"
                        name="country"
                        class="form-select"
                        required>
                  <option value="">Select Country</option>
                </select>
              </div>

              <div class="col-md-4">
                <label class="form-label">State</label>
                <select id="stateSelect"
                        name="state"
                        class="form-select"
                        required disabled>
                  <option value="">Select State</option>
                </select>
              </div>

              <div class="col-md-4">
                <label class="form-label">City</label>
                <select id="citySelect"
                        name="city"
                        class="form-select"
                        required disabled>
                  <option value="">Select City</option>
                </select>
              </div>
            </div>

            <!-- Venue / academy name -->
            <div class="mb-3">
              <label class="form-label">Venue / Academy Name</label>
              <input type="text"
                     name="venue"
                     class="form-control"
                     placeholder="e.g. Andheri Sports Complex"
                     value="{{ form_data.venue if form_data and form_data.venue else '' }}">
            </div>

            <!-- Description -->
            <div class="mb-3">
              <label class="form-label">Job Description</label>
              <textarea name="description"
                        rows="4"
                        class="form-control"
                        placeholder="Describe the role, responsibilities, and expectations."
                        required>{{ form_data.description if form_data and form_data.description else '' }}</textarea>
            </div>

            <!-- Requirements -->
            <div class="mb-3">
              <label class="form-label">Requirements</label>
              <textarea name="requirements"
                        rows="3"
                        class="form-control"
                        placeholder="Certifications, experience, skills, etc.">{{ form_data.requirements if form_data and form_data.requirements else '' }}</textarea>
            </div>

            <!-- Screening questions -->
            <div class="mb-3">
              <label class="form-label">Screening Questions</label>
              <textarea name="screening_questions"
                        rows="2"
                        class="form-control"
                        placeholder="Separate questions with | (pipe).">{{ form_data.screening_questions if form_data and form_data.screening_questions else '' }}</textarea>
            </div>

            <!-- Job type and working hours -->
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Job Type</label>
                {% set jt = form_data.job_type if form_data and form_data.job_type else 'Full Time' %}
                <select name="job_type" class="form-select">
                  <option value="Full Time" {{ 'selected' if jt == 'Full Time' else '' }}>Full Time</option>
                  <option value="Part Time" {{ 'selected' if jt == 'Part Time' else '' }}>Part Time</option>
                  <option value="Internship" {{ 'selected' if jt == 'Internship' else '' }}>Internship</option>
                  <option value="Contract" {{ 'selected' if jt == 'Contract' else '' }}>Contract</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Working Hours</label>
                <input type="text"
                       name="working_hours"
                       class="form-control"
                       placeholder="e.g. Mon–Fri, 4pm–8pm"
                       value="{{ form_data.working_hours if form_data and form_data.working_hours else '' }}">
              </div>
            </div>

            <!-- Salary & AI prediction -->
            <div class="row g-3 mt-3">
              <div class="col-md-6">
                <label class="form-label">Salary Range (per month)</label>
                <input type="text"
                       name="salary"
                       class="form-control"
                       placeholder="e.g. 30000 - 50000"
                       value="{% if predicted_salary %}{{ predicted_salary }}{% elif form_data and form_data.salary %}{{ form_data.salary }}{% endif %}">
              </div>
              <div class="col-md-6 d-flex align-items-end">
                <button type="submit" name="predict" class="btn btn-outline-primary w-100">
                  Get AI Salary Suggestion
                </button>
              </div>
            </div>

            {% if predicted_salary %}
            <div class="alert alert-info mt-3">
              <strong>AI Suggested:</strong> ₹{{ predicted_salary }}/month<br>
              <small class="text-muted">{{ ai_reason }}</small>
            </div>
            {% endif %}

            <div class="d-flex justify-content-end mt-4 gap-2">
              <a href="{{ url_for('employer.dashboard') }}" class="btn btn-outline-secondary">Cancel</a>
              <button type="submit" class="btn btn-primary">Post Job</button>
            </div>
          </form>
        </div>
      </div>

    </div>

    <div class="col-lg-4">
      <div class="card shadow-sm border-0 mb-3">
        <div class="card-body">
          <h5 class="card-title">Tips for better matches</h5>
          <ul class="small text-muted mb-0">
            <li>Use a clear, specific job title.</li>
            <li>Add detailed requirements and responsibilities.</li>
            <li>Pick the exact city so local coaches can find you.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Static India-only location data -->
<script>
const locationData = {
  "India": {
    "Maharashtra": ["Mumbai", "Pune", "Nagpur"],
    "Delhi": ["New Delhi"],
    "Karnataka": ["Bengaluru", "Mysuru"],
    "Gujarat": ["Ahmedabad", "Surat", "Vadodara"],
    "Uttar Pradesh": ["Lucknow", "Noida", "Kanpur"]
  }
};

const countrySelect = document.getElementById('countrySelect');
const stateSelect   = document.getElementById('stateSelect');
const citySelect    = document.getElementById('citySelect');

const preCountry = "{{ form_data.country if form_data and form_data.country else '' }}";
const preState   = "{{ form_data.state if form_data and form_data.state else '' }}";
const preCity    = "{{ form_data.city if form_data and form_data.city else '' }}";

function loadCountries() {
  Object.keys(locationData).forEach(country => {
    const opt = document.createElement('option');
    opt.value = country;
    opt.textContent = country;
    if (country === preCountry) opt.selected = true;
    countrySelect.appendChild(opt);
  });

  if (preCountry) {
    populateStates(preCountry);
  }
  if (preCountry && preState) {
    populateCities(preCountry, preState);
  }
}

function populateStates(country) {
  stateSelect.innerHTML = '<option value="">Select State</option>';
  citySelect.innerHTML  = '<option value="">Select City</option>';
  stateSelect.disabled  = true;
  citySelect.disabled   = true;

  if (!country || !locationData[country]) return;

  Object.keys(locationData[country]).forEach(state => {
    const opt = document.createElement('option');
    opt.value = state;
    opt.textContent = state;
    if (state === preState) opt.selected = true;
    stateSelect.appendChild(opt);
  });

  if (stateSelect.options.length > 1) {
    stateSelect.disabled = false;
  }
}

function populateCities(country, state) {
  citySelect.innerHTML = '<option value="">Select City</option>';
  citySelect.disabled  = true;

  if (!country || !state || !locationData[country][state]) return;

  locationData[country][state].forEach(city => {
    const opt = document.createElement('option');
    opt.value = city;
    opt.textContent = city;
    if (city === preCity) opt.selected = true;
    citySelect.appendChild(opt);
  });

  if (citySelect.options.length > 1) {
    citySelect.disabled = false;
  }
}

countrySelect.addEventListener('change', () => {
  populateStates(countrySelect.value);
});

stateSelect.addEventListener('change', () => {
  populateCities(countrySelect.value, stateSelect.value);
});

document.addEventListener('DOMContentLoaded', loadCountries);
</script>
{% endblock %}
