<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin Hirer Reviews</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .badge-pending{background:#f59e0b;}
    .badge-approved{background:#10b981;}
    .badge-rejected{background:#ef4444;}
  </style>
</head>
<body class="p-4">
  <h2>Admin: Hirer Reviews</h2>
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for m in messages %}
        <div class="alert alert-info">{{ m }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>ID</th><th>Institute</th><th>OTP Email</th><th>OTP Phone</th>
        <th>L1</th><th>L2</th><th>Compliance</th><th>Final</th><th>Ready</th><th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for h in hirers %}
        {% set hr = reviews.get(h.id) %}
        <tr>
          <td>{{ h.id }}</td>
          <td>{{ h.institute_name }}</td>
          <td>{{ h.email_otp_status }}</td>
          <td>{{ h.phone_otp_status }}</td>
          <td><span class="badge text-bg-light {{ 'badge-'+hr.l1_status|lower if hr else '' }}">{{ hr.l1_status if hr else 'Pending' }}</span></td>
          <td><span class="badge text-bg-light {{ 'badge-'+hr.l2_status|lower if hr else '' }}">{{ hr.l2_status if hr else 'Pending' }}</span></td>
          <td><span class="badge text-bg-light {{ 'badge-'+hr.compliance_status|lower if hr else '' }}">{{ hr.compliance_status if hr else 'Not Required' }}</span></td>
          <td><strong>{{ hr.final_status if hr else 'Pending' }}</strong></td>
          <td>{{ 'Yes' if (hr and hr.ready_to_post) else 'No' }}</td>
          <td>
            <form method="POST" action="{{ url_for('admin.update_hirer_review', hirer_id=h.id) }}" class="d-flex gap-2">
              <input type="hidden" name="action" value="l1">
              <select name="status" class="form-select form-select-sm" style="width:140px">
                <option>Pending</option><option>Approved</option><option>Rejected</option>
              </select>
              <input name="note" class="form-control form-control-sm" placeholder="L1 note" style="width:160px">
              <button class="btn btn-sm btn-primary">Save L1</button>
            </form>

            <form method="POST" action="{{ url_for('update_hirer_review', hirer_id=h.id) }}" class="d-flex gap-2 mt-2">
              <input type="hidden" name="action" value="l2">
              <select name="status" class="form-select form-select-sm" style="width:140px">
                <option>Pending</option><option>Approved</option><option>Rejected</option>
              </select>
              <input name="note" class="form-control form-control-sm" placeholder="L2 note" style="width:160px">
              <button class="btn btn-sm btn-secondary">Save L2</button>
            </form>

            <form method="POST" action="{{ url_for('update_hirer_review', hirer_id=h.id) }}" class="d-flex gap-2 mt-2">
              <input type="hidden" name="action" value="compliance">
              <select name="status" class="form-select form-select-sm" style="width:160px">
                <option>Not Required</option><option>Pending</option><option>Approved</option><option>Rejected</option>
              </select>
              <input name="note" class="form-control form-control-sm" placeholder="Compliance note" style="width:160px">
              <button class="btn btn-sm btn-warning">Save Compliance</button>
            </form>

            <form method="POST" action="{{ url_for('admin.update_hirer_review', hirer_id=h.id) }}" class="d-flex gap-2 mt-2">
              <input type="hidden" name="action" value="docs">
              <div class="form-check"><input class="form-check-input" type="checkbox" name="docs_address_proof" {% if hr and hr.docs_address_proof %}checked{% endif %}> <label class="form-check-label">Address</label></div>
              <div class="form-check"><input class="form-check-input" type="checkbox" name="docs_registration" {% if hr and hr.docs_registration %}checked{% endif %}> <label class="form-check-label">Registration</label></div>
              <div class="form-check"><input class="form-check-input" type="checkbox" name="docs_website" {% if hr and hr.docs_website %}checked{% endif %}> <label class="form-check-label">Website</label></div>
              <div class="form-check"><input class="form-check-input" type="checkbox" name="docs_maps_link" {% if hr and hr.docs_maps_link %}checked{% endif %}> <label class="form-check-label">Maps</label></div>
              <button class="btn btn-sm btn-outline-dark">Save Docs</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</body>
</html>