{% extends "base.html" %}
{% block content %}

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">

      <!-- ================= HEADER ================= -->
      <div class="glass-card p-4 mb-4 text-center">
        <h2 class="fw-bold mb-1">AI Resume Builder</h2>
        <p class="text-muted small mb-2">
          Type in Hindi or English. Resume will be generated automatically.
        </p>

        <!-- UNDER DEVELOPMENT NOTE -->
        <div class="alert alert-warning small mb-3">
          ðŸš§ <strong>Voice Resume Builder</strong> is currently under development.<br>
          Please type your details below for now.
        </div>

        <!-- INSTRUCTIONS -->
        <div class="alert alert-info text-start small mb-3">
          <strong>How to get best results:</strong>
          <ul class="mb-1 ps-3">
            <li>Write one sentence per line</li>
            <li>Mention experience in numbers (example: 5 years)</li>
            <li>Write certifications clearly (AIFF Level One, BCCI Level One)</li>
            <li>Hindi or English both are supported</li>
          </ul>
          <em>
            Resume will be generated using professional English templates.
            Full Hindi-to-English AI translation is coming soon.
          </em>
        </div>

        <!-- INPUT AREA -->
        <textarea id="resumeInput"
          class="form-control mb-3"
          rows="7"
          placeholder="à¤®à¥‡à¤°à¤¾ à¤¨à¤¾à¤® à¤…à¤®à¤¿à¤¤ à¤µà¤°à¥à¤®à¤¾ à¤¹à¥ˆà¥¤
à¤®à¥ˆà¤‚ à¤«à¥à¤Ÿà¤¬à¥‰à¤² à¤•à¥‹à¤š à¤¹à¥‚à¤à¥¤
à¤®à¥à¤à¥‡ 5 à¤¸à¤¾à¤² à¤•à¤¾ à¤…à¤¨à¥à¤­à¤µ à¤¹à¥ˆà¥¤
à¤®à¥ˆà¤‚ à¤…à¤‚à¤¡à¤° 14 à¤”à¤° à¤…à¤‚à¤¡à¤° 16 à¤–à¤¿à¤²à¤¾à¤¡à¤¼à¤¿à¤¯à¥‹à¤‚ à¤•à¥‹ à¤ªà¥à¤°à¤¶à¤¿à¤•à¥à¤·à¤£ à¤¦à¥‡à¤¤à¤¾ à¤¹à¥‚à¤à¥¤
à¤®à¥ˆà¤‚ à¤«à¤¿à¤Ÿà¤¨à¥‡à¤¸ à¤”à¤° à¤…à¤¨à¥à¤¶à¤¾à¤¸à¤¨ à¤ªà¤° à¤§à¥à¤¯à¤¾à¤¨ à¤¦à¥‡à¤¤à¤¾ à¤¹à¥‚à¤à¥¤
à¤®à¥ˆà¤‚ AIFF Level One certified à¤¹à¥‚à¤à¥¤"></textarea>

        <button class="btn btn-primary" onclick="generateResume()">
          Generate Resume
        </button>

        <p id="statusText" class="small text-muted mt-2"></p>
      </div>

      <!-- ================= RESUME OUTPUT ================= -->
      <div id="printableResume" class="bg-white p-5 shadow rounded">

        <!-- HEADER -->
        <div class="d-flex justify-content-between border-bottom pb-3 mb-4">
          <div>
            <h1 id="resumeName" class="fw-bold display-5" contenteditable="true">
              Professional Coach
            </h1>
            <h5 id="resumeHeadline" class="text-primary fw-bold" contenteditable="true">
              Sports Coach
            </h5>
          </div>
          <div class="text-end small">
            <div contenteditable="true">{{ current_user.email }}</div>
          </div>
        </div>

        <!-- SUMMARY -->
        <section class="mb-4">
          <h4 class="fw-bold border-bottom pb-2">Professional Summary</h4>
          <p id="resumeSummary" contenteditable="true" class="lead">
            Resume summary will appear here.
          </p>
        </section>

        <!-- SKILLS -->
        <section class="mb-4">
          <h4 class="fw-bold border-bottom pb-2">Core Skills</h4>
          <div id="resumeSkills" class="d-flex flex-wrap gap-2" contenteditable="true"></div>
        </section>

        <!-- EXPERIENCE -->
        <section class="mb-4">
          <h4 class="fw-bold border-bottom pb-2">Experience</h4>
          <ul id="resumeExperience" class="list-unstyled"></ul>
        </section>

        <!-- CERTIFICATIONS -->
        <section class="mb-4">
          <h4 class="fw-bold border-bottom pb-2">Certifications</h4>
          <ul id="resumeCerts"></ul>
        </section>

        <!-- ACHIEVEMENTS -->
        <section>
          <h4 class="fw-bold border-bottom pb-2">Achievements</h4>
          <ul id="resumeAchievements"></ul>
        </section>

        <div class="text-center mt-4">
          <button onclick="window.print()" class="btn btn-outline-primary btn-sm">
            Download PDF
          </button>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ================= STYLES ================= -->
<style>
[contenteditable="true"]:hover {
  background: rgba(255,255,0,0.12);
  outline: 1px dashed #ccc;
}

@media print {
  body * { visibility: hidden; }
  #printableResume, #printableResume * { visibility: visible; }
  #printableResume {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    box-shadow: none;
  }
}
</style>

<!-- ================= SCRIPT ================= -->
<script>
async function generateResume() {
  const input = document.getElementById("resumeInput").value;
  const status = document.getElementById("statusText");

  if (!input.trim()) {
    status.innerText = "âš ï¸ Please enter some details first.";
    return;
  }

  status.innerText = "â³ Generating resume...";

  const res = await fetch("/text-to-resume", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text: input })
  });

  const data = await res.json();

  document.getElementById("resumeName").innerText = data.full_name;
  document.getElementById("resumeHeadline").innerText = data.headline;
  document.getElementById("resumeSummary").innerText = data.summary;

  document.getElementById("resumeSkills").innerHTML =
    data.skills.map(s => `<span class="badge bg-primary">${s}</span>`).join("");

  document.getElementById("resumeExperience").innerHTML =
    data.experience.map(e =>
      `<li><strong>${e.role}</strong><p>${e.description}</p></li>`
    ).join("");

  document.getElementById("resumeCerts").innerHTML =
    data.certifications.map(c => `<li>${c}</li>`).join("");

  document.getElementById("resumeAchievements").innerHTML =
    data.achievements.map(a => `<li>${a}</li>`).join("");

  status.innerText = "âœ… Resume generated successfully. You can edit before downloading.";
}
</script>

{% endblock %}
